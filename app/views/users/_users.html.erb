<table class="table table-striped">
  <% @users.each do |user| %>
      <tr class="row">
        <td><%= link_to user.name, user %></td>
        <td>
          <% if user_signed_in? && (current_user.admin? || current_user == @user) %>
              <%= mail_to user.email, user.email %>
          <% end %></td>
        <td>
          <% if user_signed_in? && current_user.admin? %>
              <%= link_to 'Edit', edit_user_path(user) %>
          <% else %>
              <%= link_to 'Edit', edit_user_registration_path if can? :update, user %>
          <% end %></td>
        <td>
          <% if user_signed_in? && current_user.admin? %>
              <%= link_to 'Deactivate', user, method: :delete,
                          data: {confirm: 'Are you sure?'} %>
          <% else %>
              <%= link_to 'Deactivate', cancel_user_registration_path,
                          data: {confirm: 'Are you sure?'} if can? :destroy, user %>
          <% end %></td>
      </tr>
  <% end %>
</table>
